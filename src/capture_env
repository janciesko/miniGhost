#!/bin/bash

cc=${1}
ld=${2}
cf=${3}
arch=${4}

date=`date`
dir=`/bin/pwd`

hostname=`uname -n`
errcode="$?"
if [ ${errcode} != "0" ] ; then
hostname="unknown";
fi

#mods=`module list 2>&1 | grep -v Loaded | tr -d '\n'`

cat << END_CAT > MG_ENV.c
#include <stdio.h>

int MG_Env ( FILE *fp ) {
// Do not edit this file, it is automatically generated by the
// script capture_env.

   fprintf ( fp, "code: miniGhost_tp \n" );
   fprintf ( fp, "version:0.1.0 \n" );
   fprintf ( fp, "compiled_on: ${date} \n" );
   fprintf ( fp, "directory: ${dir} \n" );
   fprintf ( fp, "C_compiler: ${cc} \n" );
   fprintf ( fp, "linker: ${ld} \n" );
   fprintf ( fp, "C_flags: ${cf} \n" );
   fprintf ( fp, "arch: ${arch} \n" );
   fprintf ( fp, "hostname: ${hostname} \n" );
END_CAT
for i in `module list 2>&1 | grep -v Loaded | tr -d ' '`
do
mod=`echo $i | tr ')' ':' | sed -e 's/:/: /'`
cat << END_CAT1 >> MG_ENV.c
   fprintf ( fp, "module_list${mod} \n\n" );
   return ( 0 );
END_CAT1
done
cat << END_CAT2 >> MG_ENV.c

}

END_CAT2
